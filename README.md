# Telegram Bot "–ê–ø—Ä–µ–ª—å –ü–µ—Ä–µ–≤–æ–∑–∫–∏" v2.0

–¢–µ—Å—Ç–æ–≤—ã–π Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–≤–æ–∑–æ–∫ —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Google Sheets.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ë–æ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ —Å–æ—Ñ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—Ä–æ–Ω–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–≤–æ–∑–∫–∏ —á–µ—Ä–µ–∑ —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—É—Ç–µ–º –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ inline-–∫–Ω–æ–ø–∫–∏. –û—Å–Ω–æ–≤–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å v2.0 - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google –¢–∞–±–ª–∏—Ü–µ–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–∑–∫–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîî **–°–ø–∏—Å–æ–∫ –ø—Ä—è–º—ã—Ö –ø–µ—Ä–µ–≤–æ–∑–æ–∫** —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- üìã **–ú–æ–∏ –ø–µ—Ä–µ–≤–æ–∑–∫–∏** - –ª–∏—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–∑–æ–∫
- ‚úÖ **–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–∑–æ–∫** —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç race condition
- ‚ùå **–û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Sheets** (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
- ‚è∞ **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è** –ø–µ—Ä–µ–≤–æ–∑–æ–∫ –≤ 11:30 –ú–°–ö
- üì¢ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –æ –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–≤–æ–∑–∫–∞—Ö

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
april2/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.py       # /start –∫–æ–º–∞–Ω–¥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ menu.py        # –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ–Ω—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shipments.py   # –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–≤–æ–∑–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ booking.py     # –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callbacks.py   # –†–æ—É—Ç–µ—Ä callback-–∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ database/          # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py      # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.py  # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ crud.py        # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ google_sheets/     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manager.py     # –ú–µ–Ω–µ–¥–∂–µ—Ä —Ç–∞–±–ª–∏—Ü—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sync.py        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ scheduler/         # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ background.py  # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jobs.py        # –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ utils/             # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py   # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messages.py    # –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notifications.py # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ main.py            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ credentials/           # –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ docker-compose.yml     # Docker –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile            # Docker –æ–±—Ä–∞–∑
‚îî‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- PostgreSQL 14+
- Telegram Bot Token
- Google Cloud Project —Å Google Sheets API

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd april2
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# Telegram Bot
BOT_TOKEN=your_bot_token_here

# Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=april_bot
DB_USER=postgres
DB_PASSWORD=your_password

# Google Sheets
GOOGLE_SHEET_ID=your_sheet_id_here
GOOGLE_CREDENTIALS_FILE=credentials/google_credentials.json
GOOGLE_SHEET_NAME=–ü–µ—Ä–µ–≤–æ–∑–∫–∏
SYNC_INTERVAL=10

# Timezone
TIMEZONE=Europe/Moscow

# Scheduler
PUBLISH_HOUR=11
PUBLISH_MINUTE=30

# Logging
LOG_LEVEL=INFO
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets API

#### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Google Cloud

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://console.cloud.google.com/
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç "April Bot"
3. –í–∫–ª—é—á–∏—Ç–µ **Google Sheets API**
4. –í–∫–ª—é—á–∏—Ç–µ **Google Drive API**

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ Service Account

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **IAM & Admin** ‚Üí **Service Accounts**
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Service Account
3. –°–∫–∞—á–∞–π—Ç–µ JSON-–∫–ª—é—á
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ `credentials/google_credentials.json`

#### –®–∞–≥ 3: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à—É Google –¢–∞–±–ª–∏—Ü—É
2. –ù–∞–∂–º–∏—Ç–µ **"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"**
3. –î–æ–±–∞–≤—å—Ç–µ email Service Account (–∏–∑ JSON-—Ñ–∞–π–ª–∞)
4. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∞ **"–†–µ–¥–∞–∫—Ç–æ—Ä"**

#### –®–∞–≥ 4: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Google –¢–∞–±–ª–∏—Ü—ã

–°–æ–∑–¥–∞–π—Ç–µ –ª–∏—Å—Ç —Å –∏–º–µ–Ω–µ–º **"–ü–µ—Ä–µ–≤–æ–∑–∫–∏"** —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏:

| A | B | C | D | E | F | G | H | I | J | K | L | M | N | O | P |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| shipment_id | loading_point | loading_date | direction | weight | volume | start_address | end_address | points_count | distance | cost | vehicle | driver | status | booked_by | booked_at |

**–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**

| A | B | C | D | E | F | G | H | I | J | K | L | M | N | O | P |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| 50002523 | –†–¶ –ß–µ–ª—è–±–∏–Ω—Å–∫ | 2025-11-09 11:00:00 | –ê—Ä–∞–º–∏–ª—å | 1.08 | 8.46 | –°—ã—Å–µ—Ä—Ç—å, –¢–∏–º–∏—Ä—è–∑–µ–≤–∞, 2 | –ö—É–Ω–∞—à–∞–∫, 8 –ú–∞—Ä—Ç–∞ 6 | 21 | 590 | 590 –∫–º.–∫–º | –ë–ï–õ–ê–í–ê 1220W0 –ú113–ï–£774 | –í–æ—Ä–æ—à–∏–ª–æ–≤ –ï–≤–≥–µ–Ω–∏–π –Æ—Ä—å–µ–≤–∏—á | available | | |

**–í–∞–∂–Ω–æ:**
- –ö–æ–ª–æ–Ω–∫–∏ A-M –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- –ö–æ–ª–æ–Ω–∫–∏ N-P –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–æ—Ç–æ–º –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
createdb april_bot

# –ò–ª–∏ —á–µ—Ä–µ–∑ psql
psql -U postgres
CREATE DATABASE april_bot;
```

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞.

### 6. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
python -m bot.main

# –ò–ª–∏ —á–µ—Ä–µ–∑ Docker
docker-compose up -d
```

## üîÑ –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–∑–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ Google –¢–∞–±–ª–∏—Ü—É (–∫–æ–ª–æ–Ω–∫–∏ A-M)
2. –ë–æ—Ç –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—É—é –ø–µ—Ä–µ–≤–æ–∑–∫—É –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥
3. –ë–æ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–≤–æ–∑–∫—É –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î
4. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:
   ```
   –ü–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–∑–∫–∏.
   –ù–∞–∂–º–∏—Ç–µ /start –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–µ–Ω—é
   ```

### –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–∑–∫–∏

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–∑–∫—É –∏–∑ —Å–ø–∏—Å–∫–∞
2. –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "‚úÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"
3. –ë–æ—Ç —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
4. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î (status ‚Üí booked)
   - –û–±–Ω–æ–≤–ª—è–µ—Ç Google –¢–∞–±–ª–∏—Ü—É (–∫–æ–ª–æ–Ω–∫–∏ N, O, P)
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
5. –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ (—É–∂–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞):
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª

### –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –≤ "–ú–æ–∏ –ø–µ—Ä–µ–≤–æ–∑–∫–∏"
2. –í—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–∑–∫—É
3. –ù–∞–∂–∏–º–∞–µ—Ç "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"
4. –ë–æ—Ç:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î (status ‚Üí available)
   - –û—á–∏—â–∞–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ N, O, P –≤ Google –¢–∞–±–ª–∏—Ü–µ
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Google Sheets

```bash
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ Google –¢–∞–±–ª–∏—Ü—É
# –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 —Å–µ–∫—É–Ω–¥
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞:
# ‚úÖ Added new shipment: 50002523
# üì¢ Notified X users about new shipments
```

### –¢–µ—Å—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–∞—Ö –∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω—É –ø–µ—Ä–µ–≤–æ–∑–∫—É. –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –≤—Ç–æ—Ä–æ–π - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –ø–µ—Ä–µ–≤–æ–∑–∫–∞ —É–∂–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞.

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
- –ö–æ–Ω—Å–æ–ª—å (stdout)
- –§–∞–π–ª `bot.log`

–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- **INFO**: –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞
- **WARNING**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- **ERROR**: –û—à–∏–±–∫–∏
- **DEBUG**: –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤:

```
2025-11-05 11:30:00 - bot.scheduler.jobs - INFO - ‚è∞ Daily publication job triggered at 11:30
2025-11-05 11:30:15 - bot.google_sheets.sync - INFO - ‚úÖ Added new shipment: 50002523
2025-11-05 11:30:15 - bot.utils.notifications - INFO - üì§ Sent notifications to 25/25 users
2025-11-05 11:35:42 - bot.handlers.booking - INFO - üì¶ User 123456789 (@john_doe) attempting to book shipment 50002523
2025-11-05 11:35:43 - bot.handlers.booking - INFO - ‚úÖ Shipment 50002523 booked by @john_doe
```

## üê≥ Docker

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —É–¥–∞–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
docker-compose down -v
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `.env`:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | - |
| `DB_HOST` | –•–æ—Å—Ç PostgreSQL | localhost |
| `DB_PORT` | –ü–æ—Ä—Ç PostgreSQL | 5432 |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | april_bot |
| `GOOGLE_SHEET_ID` | ID Google –¢–∞–±–ª–∏—Ü—ã | - |
| `SYNC_INTERVAL` | –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Å–µ–∫) | 10 |
| `PUBLISH_HOUR` | –ß–∞—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ | 11 |
| `PUBLISH_MINUTE` | –ú–∏–Ω—É—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ | 30 |
| `TIMEZONE` | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å | Europe/Moscow |

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –§–∞–π–ª `credentials/google_credentials.json` –≤ `.gitignore`
- ‚úÖ Service Account —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- ‚úÖ Row-level locking –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç race conditions
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets
- ‚úÖ Rate limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Google –¢–∞–±–ª–∏—Ü—ã

### –ö–æ–ª–æ–Ω–∫–∏ A-M (–∑–∞–ø–æ–ª–Ω—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)

- **A**: `shipment_id` - –ù–æ–º–µ—Ä –ø–µ—Ä–µ–≤–æ–∑–∫–∏ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- **B**: `loading_point` - –¢–æ—á–∫–∞ –ø–æ–≥—Ä—É–∑–∫–∏
- **C**: `loading_date` - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ–¥–∞—á–∏ (YYYY-MM-DD HH:MM:SS)
- **D**: `direction` - –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **E**: `weight` - –í–µ—Å (—á–∏—Å–ª–æ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π)
- **F**: `volume` - –û–±—ä–µ–º (—á–∏—Å–ª–æ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π)
- **G**: `start_address` - –ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞
- **H**: `end_address` - –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞
- **I**: `points_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)
- **J**: `distance` - –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–º (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)
- **K**: `cost` - –°—Ç–æ–∏–º–æ—Å—Ç—å (—Ç–µ–∫—Å—Ç)
- **L**: `vehicle` - –ê–≤—Ç–æ–º–æ–±–∏–ª—å
- **M**: `driver` - –í–æ–¥–∏—Ç–µ–ª—å

### –ö–æ–ª–æ–Ω–∫–∏ N-P (–∑–∞–ø–æ–ª–Ω—è–µ—Ç –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

- **N**: `status` - –°—Ç–∞—Ç—É—Å (available/booked)
- **O**: `booked_by` - –ö—Ç–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª (@username)
- **P**: `booked_at` - –í—Ä–µ–º—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (YYYY-MM-DD HH:MM:SS)

## üîÑ API Endpoints (Callback Data)

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç callback_data –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:

| Callback | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `menu:direct_shipments` | –°–ø–∏—Å–æ–∫ –ø—Ä—è–º—ã—Ö –ø–µ—Ä–µ–≤–æ–∑–æ–∫ |
| `menu:my_shipments` | –ú–æ–∏ –ø–µ—Ä–µ–≤–æ–∑–∫–∏ |
| `menu:highway_shipments` | –ú–∞–≥–∏—Å—Ç—Ä–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–∑–∫–∏ (–∑–∞–≥–ª—É—à–∫–∞) |
| `menu:settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞–≥–ª—É—à–∫–∞) |
| `nav:back_to_menu` | –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `shipment:view:prefix:id:page` | –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–≤–æ–∑–∫–∏ |
| `shipment:book:id:page:prefix` | –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫—É |
| `shipment:cancel:id:page` | –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `page:prefix:page_num` | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã |

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–æ—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Google Sheets

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ `credentials/google_credentials.json`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Service Account –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `GOOGLE_SHEET_ID` –≤ `.env`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ª–∏—Å—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "–ü–µ—Ä–µ–≤–æ–∑–∫–∏" (–∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)

### –ü–µ—Ä–µ–≤–æ–∑–∫–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f bot`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–∞—Ç—ã)
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å `SYNC_INTERVAL` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `.env`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `BOT_TOKEN`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω: `docker-compose ps`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Telegram Bot API](https://core.telegram.org/bots/api)
- [python-telegram-bot Documentation](https://docs.python-telegram-bot.org/)
- [Google Sheets API](https://developers.google.com/sheets/api)
- [SQLAlchemy Documentation](https://docs.sqlalchemy.org/)

## üë• –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

[–£–∫–∞–∑–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é]

---

**–í–µ—Ä—Å–∏—è:** 2.0
**–î–∞—Ç–∞:** 2025-11-05